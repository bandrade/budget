<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	template="/WEB-INF/templates/default.xhtml">

	<ui:param name="pageTitle" value="Human Tasks" />
	<f:metadata>
        <f:viewParam name="taskId" value="#{criarBudgetAction.idTarefa}" />
        <f:viewParam name="processInstanceId" value="#{criarBudgetAction.idInstanciaProcesso}" />
        <f:event type="preRenderView" listener="#{criarBudgetAction.obterDadosBudget()}" />
    </f:metadata>

	<ui:define name="content">
		<h:form id="form"> 
			<p:panel id="content">
				<h3>Criar Budget</h3>
				<p:panelGrid columns="2">
					<p:outputLabel value="Centro de Custo:"></p:outputLabel>
					<p:outputLabel styleClass="bold-label" value="#{criarBudgetAction.centroDeCusto.nome}"></p:outputLabel>
					<p:outputLabel value="Ano:"></p:outputLabel>
					<p:outputLabel styleClass="bold-label" value="#{criarBudgetAction.ano}"></p:outputLabel>
				</p:panelGrid>
				<p:panelGrid columns="3" >
				<p:outputLabel value="* Tipo de Despesa:"></p:outputLabel>
					<p:autoComplete id="cboTipoDespesa" dropdown="true" value="#{criarBudgetAction.tipoDespesa}" completeMethod="#{criarBudgetAction.autocompleteTipoDespesa}" 
					 var="_tipoDespesa" itemLabel="#{_tipoDespesa.nome}" itemValue="#{_tipoDespesa}" emptyMessage="NAO ENCONTRADO" effect="size"   
					 scrollHeight="300"
					 styleClass="input"
					 converter="com.dupont.EntityConverter" />
				<p:commandButton value="Incluir Tipo Despesa"
						action="#{criarBudgetAction.incluirTipoDespesa()}" 
						update=":form"
						style="margin-left:20px"/>
				</p:panelGrid>
				<p:panelGrid id="panelDetalhe" columns="1">
				
				
				<p:dataTable 
					emptyMessage="Não existem despesas cadastradas" 
					value="#{criarBudgetAction.despesasNoDetalhe}"
					selection="#{criarBudgetAction.despesaDetalheSelecionada}"
					var="detalheDespesa"
					paginator="true"
					sortBy="#{detalheDespesa.tipoDespesa}"
					editable="true" 
					editMode="cell" widgetVar="cellDespesa"
					paginatorPosition="bottom"
					rows="20" style="margin-left:-10px;overflow:wrap;"
					id="tableDespesas"
					>
					<f:facet name="header">
       					Despesas
  						 </f:facet>
  					 <p:ajax event="cellEdit" listener="#{criarBudgetAction.editarCelula}" update=":messages"  onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()"/>
					<p:column colspan="9" rendered="#{detalheDespesa.firstLine}" style="background-color:#CE0909;color:#fff;">
							<h:outputText value="#{detalheDespesa.tipoDespesa.nome}" />
					</p:column>
					<p:column rendered="#{not detalheDespesa.firstLine}" width="4%" style="text-align:center;">
							<h:outputText value="#{detalheDespesa.indice}" />
					</p:column>
					<p:column  width="12%" rendered="#{not detalheDespesa.firstLine}">
						<f:facet name="header">
							<h:outputText value="Ação" />
						</f:facet>
							
						 <p:cellEditor>
			               	<f:facet name="output"><h:outputText value="#{detalheDespesa.acao.nome}" /></f:facet>
            				<f:facet name="input">
            					<p:inputTextarea value="#{detalheDespesa.acaoString}" cols="20" rows="3"></p:inputTextarea>
            				</f:facet>
			             </p:cellEditor>
					</p:column>
					
					<p:column rendered="#{not detalheDespesa.firstLine}" width="10%">
						<f:facet name="header">
							<h:outputText value="Produto" />
						</f:facet>
						<p:cellEditor>
						<f:facet name="output"><h:outputText value="#{detalheDespesa.produto.nome}" /></f:facet>
						<f:facet name="input">
            					<p:autoComplete id="cboProduto" dropdown="true" value="#{detalheDespesa.produto}" completeMethod="#{autocompleteAction.autocompleteProduto}" 
								 styleClass="input"
								 size="12"
								 scrollHeight="300"
								 var="_produto" itemLabel="#{_produto.nome}" itemValue="#{_produto}" emptyMessage="NAO ENCONTRADO" effect="size" converter="com.dupont.EntityConverter">
								 </p:autoComplete>
            			</f:facet>
						</p:cellEditor>
					</p:column>
					<p:column rendered="#{not detalheDespesa.firstLine}"  width="10%">
						<f:facet name="header">
							<h:outputText value="Cultura" />
						</f:facet>
						<p:cellEditor>
							<f:facet name="output"><h:outputText value="#{detalheDespesa.cultura.nome}" /></f:facet>
							<f:facet name="input">
									<p:autoComplete id="cboCultura" dropdown="true" value="#{detalheDespesa.cultura}" completeMethod="#{autocompleteAction.autocompleteCultura}" 
									 styleClass="input"
									 scrollHeight="300"
									 size="12"
									 converter="com.dupont.EntityConverter"
					   				 var="_cultura" itemLabel="#{_cultura.nome}" itemValue="#{_cultura}" emptyMessage="NAO ENCONTRADO" effect="size"  />
					 		</f:facet>
					 	</p:cellEditor>
					</p:column>
					<p:column width="8%" rendered="#{not detalheDespesa.firstLine}">
						<f:facet name="header">
							<h:outputText value="Distrito" />
						</f:facet>
						<p:cellEditor>
							<f:facet name="output"><h:outputText value="#{detalheDespesa.distrito.nome}" /></f:facet>
							<f:facet name="input">
									<p:autoComplete id="cboDistrito" dropdown="true" value="#{detalheDespesa.distrito}" completeMethod="#{autocompleteAction.autocompleteDistrito}" 
									 styleClass="input"
									 size="10"
									 scrollHeight="300"
									 converter="com.dupont.EntityConverter"
									 var="distrito" itemLabel="#{distrito.nome}" itemValue="#{distrito}" emptyMessage="NAO ENCONTRADO" effect="size"/>
					 		</f:facet>
					 	</p:cellEditor>
					</p:column>
					<p:column rendered="#{not detalheDespesa.firstLine}" width="15%">
						<f:facet name="header" >
							<h:outputText value="ERC" />
						</f:facet>
						<p:cellEditor>
							<f:facet name="output"><h:outputText value="#{detalheDespesa.vendedor.nome}" /></f:facet>
							<f:facet name="input">
									<p:autoComplete id="cboVendedor" dropdown="true" value="#{detalheDespesa.vendedor}" completeMethod="#{autocompleteAction.autocompleteVendedor}" 
					 				styleClass="input"
					 				scrollHeight="300"
									converter="com.dupont.EntityConverter"
					 				var="_vendedor" itemLabel="#{_vendedor.nome}" itemValue="#{_vendedor}" emptyMessage="NAO ENCONTRADO" effect="size"/>
					 		</f:facet>
					 	</p:cellEditor>
					</p:column>
					
					<p:column  width="12%" rendered="#{not detalheDespesa.firstLine}">
						<f:facet name="header">
							<h:outputText value="Comentário" />
						</f:facet>
						
						 <p:cellEditor>
			               	<f:facet name="output"><h:outputText value="#{detalheDespesa.comentario}" /></f:facet>
            				<f:facet name="input">
            					<p:inputTextarea value="#{detalheDespesa.comentario}" cols="20" rows="3" ></p:inputTextarea>
            				</f:facet>
            			</p:cellEditor>
					</p:column>
					<p:column width="8%" footerText="Total:#{facesUtils.formatarDinheiro(criarBudgetAction.valorTotalDetalhe)}" style="text-align:center"  rendered="#{not detalheDespesa.firstLine}">
						<f:facet name="header">
							<h:outputText value="*Valor Proposto" />
						</f:facet>
						
						 <p:cellEditor>
			               	<f:facet name="output">
			               		<h:outputText value="#{detalheDespesa.valor}" >
									<f:convertNumber type="currency"/>
								</h:outputText>
							</f:facet>
            				<f:facet name="input">
            					<pe:inputNumber  id="valorTolerancia"  value="#{detalheDespesa.valor}"  converter="javax.faces.Double" required="true">
										<p:ajax  update=":form" process="@this"></p:ajax>
            					</pe:inputNumber>
            				</f:facet>
            			</p:cellEditor>
					</p:column> 
					<p:column width="4%" rendered="#{not detalheDespesa.firstLine}">
							<p:commandButton icon="ui-icon-trash" action="#{criarBudgetAction.removerDespesa()}" update=":form">
									<p:confirm header="Confirmação" message="Deseja realmente remover a despesa?" icon="ui-icon-alert"/>
									<f:setPropertyActionListener target="#{criarBudgetAction.despesaDetalheSelecionada}" value="#{detalheDespesa}"/>
							</p:commandButton>
					</p:column>
					 <p:summaryRow >
			            <p:column  style="text-align:left;background-color:#fff">
			               	<p:commandButton icon="ui-icon-plus" action="#{criarBudgetAction.adicionarDespesaPlanilha(detalheDespesa.tipoDespesa)}" update=":form"/>
			            </p:column>
      				 </p:summaryRow>
				</p:dataTable>
				
				</p:panelGrid>
					<p:panelGrid columns="1" styleClass="painel-botoes">
					<p:commandButton  id="salvar" action="#{criarBudgetAction.adicionarDespesas()}" update=":form,:messages" style=" visibility: hidden;"></p:commandButton>
					<p:defaultCommand target="salvar" />
					<p:commandButton value="Concluir"  action="#{criarBudgetAction.concluir()}" onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" >
						<p:confirm header="Confirmação" message="Confirma a conclusão da Criação do Budget?" icon="ui-icon-alert"/> 
					</p:commandButton>
				</p:panelGrid>
				</p:panel>
			
			</h:form>
			
	</ui:define>
</ui:composition>